

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Depth-wise Convolution &mdash; embARC Machine Learning Inference Library 1.00 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/style_overrides.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Pooling Group" href="pooling_grp.html" />
    <link rel="prev" title="Convolution 2D" href="convolution_2d.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> embARC Machine Learning Inference Library
          

          
          </a>

          
            
            
              <div class="version">
                1.00
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../overview/overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../library_model/library_model.html">Library Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../MLI_FP_data_format/MLI_FP_data_format.html">MLI Fixed-Point Data Format</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="MLI_kernels.html">MLI Kernels</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="convolution_grp.html">Convolution Group</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="convolution_2d.html">Convolution 2D</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Depth-wise Convolution</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#function-configuration-structure">Function Configuration Structure</a></li>
<li class="toctree-l4"><a class="reference internal" href="#kernel-interface">Kernel Interface</a></li>
<li class="toctree-l4"><a class="reference internal" href="#function-specializations">Function Specializations</a></li>
<li class="toctree-l4"><a class="reference internal" href="#conditions-for-applying-the-function">Conditions for Applying the Function</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="pooling_grp.html">Pooling Group</a></li>
<li class="toctree-l2"><a class="reference internal" href="common_grp.html">Common Group</a></li>
<li class="toctree-l2"><a class="reference internal" href="transform_grp.html">Transform Group</a></li>
<li class="toctree-l2"><a class="reference internal" href="elementwise_grp.html">Element-wise Group</a></li>
<li class="toctree-l2"><a class="reference internal" href="data_manipulation_grp.html">Data Manipulation Group</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../MLI_helpers/MLI_helpers.html">MLI Helpers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Examples_Tutorials/Examples_Tutorials.html">Examples and Tutorials</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">embARC Machine Learning Inference Library</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="MLI_kernels.html">MLI Kernels</a> &raquo;</li>
        
          <li><a href="convolution_grp.html">Convolution Group</a> &raquo;</li>
        
      <li>Depth-wise Convolution</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/MLI_kernels/convolution_depthwise.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="depth-wise-convolution">
<span id="cnvl-depth"></span><h1>Depth-wise Convolution<a class="headerlink" href="#depth-wise-convolution" title="Permalink to this headline">¶</a></h1>
<img alt="Depth-wise Convolution Operation" class="align-center" src="../_images/image107.jpg" />
<p>This kernel implements a 2D depth-wise convolution operation applying
each filter channel to each input channel separately. As a result,
output image depth is the same as input image depth.</p>
<p>MLI implementation of depth-wise convolution is compatible with caffe
implementation of convolution layer with group parameter equal to
number of input channels. In comparison with TensorFlow
implementation (<code class="docutils literal notranslate"><span class="pre">tf.nn.depthwise_conv2d</span></code> in python API), this
implementation does not support channel multiplier feature. Therefore,
the last dimension of weights tensor must be equal to 1.</p>
<p>For the example for CHW data layout, if the input feature map is [Ci,
Hi, Wi] and the kernel is [Ci, Hk, Wk,1], the output feature map is
[Ci, Ho, Wo] matrix where the output dimensions Ho and Wo are
calculated dynamically according to convolution parameters (such as
padding and stride) in the same way as for general convolution 2D
kernel (see <a class="reference internal" href="convolution_2d.html#cnvl-2d"><span class="std std-ref">Convolution 2D</span></a>).</p>
<p>ReLU activation function might be applied to result of convolution. The
following types of ReLU activations are supported (for more info see
<a class="reference internal" href="trans_relu.html#relu"><span class="std std-ref">ReLU</span></a>):</p>
<ul class="simple">
<li>RELU_NONE</li>
<li>RELU_GEN</li>
<li>RELU_1</li>
<li>RELU_6</li>
</ul>
<div class="admonition caution">
<p class="first admonition-title">Caution</p>
<p class="last">Ensure that input and output
tensors do not point to
overlapped memory regions,
otherwise the behavior is
undefined.</p>
</div>
<div class="section" id="function-configuration-structure">
<span id="function-configuration-structure-1"></span><h2>Function Configuration Structure<a class="headerlink" href="#function-configuration-structure" title="Permalink to this headline">¶</a></h2>
<p>Depth-wise convolution kernel shares configuration structure with
general convolution 2D kernel. For more information see <a class="reference internal" href="convolution_2d.html#fn-conf-struct"><span class="std std-ref">Function Configuration Structure</span></a>
section of Convolution 2D function.</p>
</div>
<div class="section" id="kernel-interface">
<span id="general-api-1"></span><h2>Kernel Interface<a class="headerlink" href="#kernel-interface" title="Permalink to this headline">¶</a></h2>
<p>Interface of all specializations are the same and described in
following table.</p>
<div class="section" id="prototype">
<h3>Prototype<a class="headerlink" href="#prototype" title="Permalink to this headline">¶</a></h3>
<div class="code c highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mli_status</span> <span class="n">mli_krn_depthwise_conv2d_</span>
<span class="o">&lt;</span><span class="n">layout</span><span class="o">&gt;</span><span class="n">_</span><span class="o">&lt;</span><span class="n">data_type</span><span class="o">&gt;</span><span class="p">[</span><span class="n">_specialization</span><span class="p">](</span>
   <span class="n">const</span> <span class="n">mli_tensor</span> <span class="o">*</span><span class="ow">in</span><span class="p">,</span>
   <span class="n">const</span> <span class="n">mli_tensor</span> <span class="o">*</span><span class="n">weights</span><span class="p">,</span>
   <span class="n">const</span> <span class="n">mli_tensor</span> <span class="o">*</span><span class="n">bias</span><span class="p">,</span>
   <span class="n">const</span> <span class="n">mli_conv2d_cfg</span> <span class="o">*</span><span class="n">cfg</span><span class="p">,</span>
   <span class="n">mli_tensor</span> <span class="o">*</span><span class="n">out</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="parameters">
<h3>Parameters<a class="headerlink" href="#parameters" title="Permalink to this headline">¶</a></h3>
<table border="1" class="colwidths-given docutils" id="id1">
<caption><span class="caption-text">Kernel Interface Parameters</span><a class="headerlink" href="#id1" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="13%" />
<col width="87%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><strong>Parameter</strong></td>
<td><strong>Description</strong></td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">in</span></code></td>
<td>[IN] Pointer to input
feature map tensor</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">weights</span></code></td>
<td>[IN] Pointer to
convolution filters
weights tensor</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">bias</span></code></td>
<td>[IN] Pointer to
convolution filters
biases tensor</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">cfg</span></code></td>
<td>[IN] Pointer to
convolution
parameters structure</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">out</span></code></td>
<td>[OUT] Pointer to
output feature map
tensor. Result is
stored here</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="function-specializations">
<span id="function-specializations-1"></span><h2>Function Specializations<a class="headerlink" href="#function-specializations" title="Permalink to this headline">¶</a></h2>
<p>There are about 70 specializations for the primitive assuming various
combinations of inputs parameters. Depth-wise convolution primitive
follows the naming convention for specializations (see <a class="reference internal" href="../library_model/functions.html#spec-fns"><span class="std std-ref">Specialized Functions</span></a>).
The header file <code class="docutils literal notranslate"><span class="pre">mli_krn_depthwise_conv2d_spec_api.h</span></code> contains declarations
of all specializations for the primitive.</p>
<p><a class="reference internal" href="#non-spec-func-dw-cnvl"><span class="std std-ref">Non-Specialized Functions</span></a> does not contain specialized functions.
No functions for HWC data layout have been implemented at the moment.
To use depth-wise convolution in this case, ensure that you change weights
and inputs layout beforehand by permute primitive (see <a class="reference internal" href="data_manip_permute.html#permute"><span class="std std-ref">Permute</span></a>).</p>
<span id="non-spec-func-dw-cnvl"></span><table border="1" class="colwidths-given docutils" id="id2">
<caption><span class="caption-text">Non-Specialized Functions</span><a class="headerlink" href="#id2" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="13%" />
<col width="87%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><strong>Function</strong></th>
<th class="head"><strong>Description</strong></th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">mli_krn_depthwise_conv2d_chw_fx8</span></code></td>
<td>Switching function (see
<a class="reference internal" href="../library_model/functions.html#fns"><span class="std std-ref">Functions</span></a>); 8bit FX tensors;
Delegates calculations to
suitable specialization or
generic function.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">mli_krn_depthwise_conv2d_chw_fx16</span></code></td>
<td>Switching function (see
<a class="reference internal" href="../library_model/functions.html#fns"><span class="std std-ref">Functions</span></a>); 16bit FX tensors;
Delegates calculations to
suitable specialization or
generic function.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">mli_krn_depthwise_conv2d_chw_fx8w16d</span></code></td>
<td>General function; FX tensors
(8bit weights and biases, 16bit
input and output)</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">mli_krn_depthwise_conv2d_chw_fx8_generic</span></code></td>
<td>General function; 8bit FX
tensors</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">mli_krn_depthwise_conv2d_chw_fx16_generic</span></code></td>
<td>General function; 16bit FX
tensors</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">mli_krn_depthwise_conv2d_chw_fx16_[spec]</span></code></td>
<td>Specialization function*; 8bit FX
tensors</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">mli_krn_depthwise_conv2d_chw_fx16_[spec]</span></code></td>
<td>Specialization function*; 16bit
FX tensors</td>
</tr>
</tbody>
</table>
<div class="admonition attention">
<p class="first admonition-title">Attention</p>
<p class="last">*For specialization
functions, backward
compatibility between
different releases cannot be
guaranteed. The general
functions call the available
specializations when possible.</p>
</div>
</div>
<div class="section" id="conditions-for-applying-the-function">
<span id="conditions-for-applying-the-function-1"></span><h2>Conditions for Applying the Function<a class="headerlink" href="#conditions-for-applying-the-function" title="Permalink to this headline">¶</a></h2>
<p>Ensure that you satisfy the following conditions before applying the
function:</p>
<ul class="simple">
<li>Input, weights and bias tensors must be valid (see <a class="reference internal" href="../library_model/data.html#mli-tns-struct"><span class="std std-ref">mli_tensor Structure</span></a>).</li>
<li>Before processing, the output tensor must contain valid pointer to a
buffer with sufficient capacity (enough for result storing). It
also must contain valid element parameter (<code class="docutils literal notranslate"><span class="pre">el_params.fx.frac_bits</span></code>).</li>
<li>Before processing, the output tensor does not have to contain valid
shape, rank and element type fields. These are filled by the function.</li>
<li>Input and weights tensors data layout must be the same. Amount of
weights channels must be 1.</li>
<li>Amount of filters (first dimension of weights tensor) must be equal
to number of input channels.</li>
<li>Bias must be one-dimensional tensor. Its length must be equal to
amount of filters (first dimension of weights tensor)</li>
<li>padding_top and padding_bottom parameters must be in range of [0,
weights_height).</li>
<li><code class="docutils literal notranslate"><span class="pre">padding_left</span></code> and <code class="docutils literal notranslate"><span class="pre">padding_right</span></code> parameters must be in range of [0,
weights_width).</li>
<li><code class="docutils literal notranslate"><span class="pre">stride_width</span></code> and <code class="docutils literal notranslate"><span class="pre">stride_height</span></code> parameters must not be equal to 0.</li>
<li><code class="docutils literal notranslate"><span class="pre">weights_width</span></code> and <code class="docutils literal notranslate"><span class="pre">weights_height</span></code> must be less or equal to appropriate
dimensions of input tensor.</li>
</ul>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="pooling_grp.html" class="btn btn-neutral float-right" title="Pooling Group" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="convolution_2d.html" class="btn btn-neutral float-left" title="Convolution 2D" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Synopsys, Inc

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>