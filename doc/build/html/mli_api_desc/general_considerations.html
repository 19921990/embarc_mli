

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Description &mdash; embARC Machine Learning Inference Library 1.00a documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/style_overrides.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Arithmetic Details" href="arithmetic_details.html" />
    <link rel="prev" title="Machine Learning Inference Library API" href="index.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> embARC Machine Learning Inference Library
          

          
          </a>

          
            
            
              <div class="version">
                1.00a
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../initial/index.html">Definitions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../initial/index.html#revision-history">Revision history</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Machine Learning Inference Library API</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="#general-considerations">General Considerations</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#general-api-structure">General API Structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="#data-types">Data Types</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#mli-tensor-structure">mli_tensor Structure</a></li>
<li class="toctree-l4"><a class="reference internal" href="#mli-element-type-enumeration">mli_element_type Enumeration</a></li>
<li class="toctree-l4"><a class="reference internal" href="#mli-element-params-union">mli_element_params Union</a></li>
<li class="toctree-l4"><a class="reference internal" href="#kernel-specific-configuration-structures">Kernel Specific Configuration Structures</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#data-layout-of-multidimensional-feature-maps">Data Layout of Multidimensional Feature Maps</a></li>
<li class="toctree-l3"><a class="reference internal" href="#functions">Functions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#naming-convention">Naming Convention</a></li>
<li class="toctree-l4"><a class="reference internal" href="#specialized-functions">Specialized Functions</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#error-codes">Error Codes</a></li>
<li class="toctree-l3"><a class="reference internal" href="#global-definitions-and-library-configurability">Global Definitions and Library Configurability</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#target-platform-definition-arc-platform">Target Platform Definition (ARC_PLATFORM)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#function-parameters-examination-and-debug-mli-debug-mode">Function Parameters Examination and Debug (MLI_DEBUG_MODE)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#concatenation-primitive-maximum-tensors-to-concatenate-mli-concat-max-tensors">Concatenation Primitive: Maximum Tensors to Concatenate (MLI_CONCAT_MAX_TENSORS)</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#memory-allocation">Memory Allocation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#hardware-components-dependencies">Hardware Components Dependencies</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#dsp-control">DSP Control</a></li>
<li class="toctree-l4"><a class="reference internal" href="#agu-support">AGU Support</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="arithmetic_details.html">Arithmetic Details</a></li>
<li class="toctree-l2"><a class="reference internal" href="getting_started.html">Getting Started</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../kernel_func_desc/index.html">Kernel Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../helper_func_desc/index.html">Helper Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../final/references.html">References</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">embARC Machine Learning Inference Library</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Machine Learning Inference Library API</a> &raquo;</li>
        
      <li>Description</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/mli_api_desc/general_considerations.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="description">
<h1>Description<a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h1>
<blockquote>
<div><em>This chapter gives a brief introduction to Machine Learning
Inference Library API, the arithmetic involved, the package contents
and the build process.</em></div></blockquote>
<p></p>
</div>
<div class="section" id="general-considerations">
<h1>General Considerations<a class="headerlink" href="#general-considerations" title="Permalink to this headline">¶</a></h1>
<blockquote>
<div><p>The Machine Learning Inference Library is the basis for machine
learning inference for lower power families of ARCv2 DSP cores (ARC
EMxD and ARC HS4xD). Its purpose is to enable porting of machine
learning models mostly based on NN to ARC processors.</p>
<p>The library is a collection of ML algorithms (primitives) which
roughly can be separated into the following groups:</p>
<ul class="simple">
<li><strong>Convolution</strong> - convolve input features with a set of trained weights.</li>
<li><strong>Pooling</strong> – pool input features with a function.</li>
<li><strong>Common</strong> - Common ML, mathematical, and statistical operations</li>
<li><strong>Transform</strong> - Transform each element of input set according to a particular function</li>
<li><strong>Elementwise</strong> - Apply multi operand function element-wise to several inputs</li>
<li><strong>Data manipulation</strong> - Move input data by a specified pattern</li>
</ul>
</div></blockquote>
<p></p>
<blockquote>
<div><p>MLI supported primitives are intended for</p>
<ul class="simple">
<li>ease of use and</li>
<li>inferring efficient solutions for small/middle models using very limited resources.</li>
</ul>
</div></blockquote>
<p></p>
<div class="section" id="general-api-structure">
<span id="gen-api-struct"></span><span id="id1"></span><h2>General API Structure<a class="headerlink" href="#general-api-structure" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p>Library is implemented as a set of C functions. Each function implements one specific NN primitive. Inputs and outputs of functions are represented by tensors. In this calculation model, graph nodes are implemented by library functions (primitives), and graph edges are represented by tensors. As a result, neural network graph implementation can be represented as series of function calls. Functions are divided on two sets:</p>
<ul class="simple">
<li><strong>Kernel functions</strong>: Main implementations of ML primitives. Kernel functions process data without re-ordering to more convenient layout by copying to intermediate buffer. Avoiding such overhead provides high efficiency from one side and high sensitivity to memory latency, data size and data layout on the other side. For hardware configurations with XY memory, some kernel functions assume that data is stored in a memory that can be accessed by AGU.</li>
<li><strong>Helper functions</strong>: Provide specific functions used by primitives or required for some specific actions not directly related to graph calculations (example: data format transformation).</li>
</ul>
</div></blockquote>
<p></p>
</div>
<div class="section" id="data-types">
<span id="id2"></span><h2>Data Types<a class="headerlink" href="#data-types" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div>The library is intended to work with structured data types. Each data type groups related parameters in one entity as defined in .<strong>/include/MLI_types.h</strong> .</div></blockquote>
<div class="section" id="mli-tensor-structure">
<span id="mli-tns-struct"></span><h3>mli_tensor Structure<a class="headerlink" href="#mli-tensor-structure" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><code class="docutils literal notranslate"><span class="pre">mli_tensor</span></code> is the main container type for input and output data which
must be processed by ML algorithm. <code class="docutils literal notranslate"><span class="pre">mli_tensor</span></code> represents
multi-dimensional arrays of a particular shape and includes not only
a data, but also its shape, type, and other data-specific parameters.</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The term “data” includes input
features, output features,
layer weights, and biases. It
does not include layer
parameters such as padding or
stride for convolutional
primitives. This data
representation is common for
neural networks and other
machine learning tasks.</p>
</div>
<div class="code c highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">typedef</span> <span class="n">struct</span> \<span class="n">_mli_tensor</span> <span class="p">{</span>
   <span class="n">void</span> <span class="o">*</span><span class="n">data</span><span class="p">;</span>
   <span class="n">uint32_t</span> <span class="n">capacity</span><span class="p">;</span>
   <span class="n">uint32_t</span> <span class="n">shape</span><span class="p">[</span><span class="n">MLI_MAX_RANK</span><span class="p">];</span>
   <span class="n">uint32_t</span> <span class="n">rank</span><span class="p">;</span>
   <span class="n">mli_element_type</span> <span class="n">el_type</span><span class="p">;</span>
   <span class="n">mli_element_params</span> <span class="n">el_params</span><span class="p">;</span>
<span class="p">}</span> <span class="n">mli_tensor</span><span class="p">;</span>
</pre></div>
</div>
<p></p>
<span id="mli-tensor-struc"></span><table border="1" class="colwidths-auto docutils" id="id3">
<caption><span class="caption-number">Table 2 </span><span class="caption-text">mli_tensor Structure Fields</span><a class="headerlink" href="#id3" title="Permalink to this table">¶</a></caption>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Field name</th>
<th class="head">Field Type</th>
<th class="head">Field Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">data</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">void</span> <span class="pre">\*</span></code></td>
<td>Pointer to memory
with tensor data</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">capacity</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">uint32_t</span></code></td>
<td>Size in bytes of the
available memory,
allocated at the
address in data field</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">shape</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">uint32_t[]</span></code></td>
<td>Array with tensor
dimensions.
Dimensions must be
stored in direct
order starting from
the one with the
highest stride
between data
portions. For
example, for a matrix
of shape
[rows][columns],
shape[0] = rows and
shape[1] = columns</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">rank</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">uint32_t</span></code></td>
<td>Tensor rank with
countable number of
dimensions. Must be
less or equal to
value of MLI_MAX_RANK</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">el_type</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">mli_element</span></code></td>
<td>Type of elements
stored in the tensor.
For details, see
<a class="reference internal" href="#mli-elm-enum"><span class="std std-ref">mli_element_type Enumeration</span></a></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">el_params</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">mli_element_params</span></code></td>
<td>Parameters of
elements stored in
tensor. For details,
see
<a class="reference internal" href="#mli-el-prm-u"><span class="std std-ref">mli_element_params Union</span></a></td>
</tr>
</tbody>
</table>
<blockquote>
<div><p>Some primitives, such as slope coefficient for leaky ReLU, might
require scalar parameters which explicitly involve calculations (not
primitive configuration parameter). Such scalar
inputs/outputs are also passed to primitive as tensor of rank=1 and
shape[0]=1. For some primitives it is possible to provide scalar
value as tensor with zero rank and single value stored directly in
data field (not pointed by it).</p>
<p>All input tensors passed to primitives typically must be valid with
fields that are not conflicting. Examples of field conflicts are:</p>
<ul class="simple">
<li>Tensor shape declares more data than tensors capacity.</li>
<li>Tensor rank is bigger than MLI_MAX_RANK</li>
<li>Data pointer is invalid (NULL pointer) except cases when it is
allowed to pass scalar value directly in data field.</li>
<li>Tensor is empty (total number of elements is zero)</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="mli-element-type-enumeration">
<span id="mli-elm-enum"></span><h3>mli_element_type Enumeration<a class="headerlink" href="#mli-element-type-enumeration" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><code class="docutils literal notranslate"><span class="pre">mli_element_type</span></code> defines basic element type stored in tensor
structure (data field).</div></blockquote>
<div class="code c highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">typedef</span> <span class="n">enum</span> <span class="p">{</span>
<span class="n">MLI_EL_FX_8</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
<span class="n">MLI_EL_FX_16</span><span class="p">,</span>
<span class="p">}</span> <span class="n">mli_element_type</span><span class="p">;</span>
</pre></div>
</div>
<p></p>
<span id="mli-element-type-val-desc"></span><table border="1" class="colwidths-auto docutils" id="id4">
<caption><span class="caption-number">Table 3 </span><span class="caption-text">mli_element_type Values Description</span><a class="headerlink" href="#id4" title="Permalink to this table">¶</a></caption>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Value</th>
<th class="head">Field Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">MLI_EL_FX_8</span></code></td>
<td>8-bit deep, fixed-point data with
configurable number of fractional
bits (see <a class="reference internal" href="arithmetic_details.html#mli-fpd-fmt"><span class="std std-ref">MLI Fixed-Point Data Format</span></a>).
Data container is int8_t.
Also mentioned in this
document as fx8 type.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">MLI_EL_FX_16</span></code></td>
<td>16-bit deep fixed-point data with
configurable number of fractional
bits (see <a class="reference internal" href="arithmetic_details.html#mli-fpd-fmt"><span class="std std-ref">MLI Fixed-Point Data Format</span></a>).
Data container is int16_t.
Also mentioned in this
document as fx16 type.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="mli-element-params-union">
<span id="mli-el-prm-u"></span><h3>mli_element_params Union<a class="headerlink" href="#mli-element-params-union" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><code class="docutils literal notranslate"><span class="pre">mli_element_params</span></code> union stores data type parameters required for
arithmetical operations with tensor elements.</div></blockquote>
<div class="code c highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">typedef</span> <span class="n">union</span> \<span class="n">_mli_element_params</span> <span class="p">{</span>
   <span class="n">struct</span><span class="p">{</span>
      <span class="n">unsigned</span> <span class="n">frac_bits</span><span class="p">;</span>
   <span class="p">}</span> <span class="n">fx</span><span class="p">;</span>
<span class="p">}</span> <span class="n">mli_element_params</span><span class="p">;</span>
</pre></div>
</div>
<blockquote>
<div>Parameters are wrapped into union for future library extensibility.
The current version supports only fixed point data with configurable
number of fractional bits (see <a class="reference internal" href="arithmetic_details.html#mli-fpd-fmt"><span class="std std-ref">MLI Fixed-Point Data Format</span></a>) and union
can be interpreted only as the following structure.</div></blockquote>
<p></p>
<span id="mli-element-params-struct-fields"></span><table border="1" class="colwidths-auto docutils" id="id5">
<caption><span class="caption-number">Table 4 </span><span class="caption-text">mli_element_params Structure Fields</span><a class="headerlink" href="#id5" title="Permalink to this table">¶</a></caption>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><p class="first">Union</p>
<p class="last">Interpretation</p>
</th>
<th class="head">Field</th>
<th class="head">Field Type</th>
<th class="head">Field
Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">fx</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">frac_bits</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">uint8_t</span></code></td>
<td>Number of
fractional
bits.
Non-negative
value.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="kernel-specific-configuration-structures">
<h3>Kernel Specific Configuration Structures<a class="headerlink" href="#kernel-specific-configuration-structures" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div>Significant number of primitives must be configured by specific
parameters, which influence calculations and results, but not
directly related to input data. For example, padding and stride
values are parameters of convolution layer and the type of ReLU is a
parameter for ReLU transform layer. All specific parameters for
particular primitive type are grouped into structures. This document
describes these structures along with the primitive description they
relate to.</div></blockquote>
</div>
</div>
<div class="section" id="data-layout-of-multidimensional-feature-maps">
<span id="data-muldim"></span><h2>Data Layout of Multidimensional Feature Maps<a class="headerlink" href="#data-layout-of-multidimensional-feature-maps" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div>Functions of convolution and pooling groups deal with
multi-dimensional feature maps which might be considered as images.
In general, these maps have three dimensions with following names:
height, width, and channels (also called depth). Despite logical
organization, multidimensional feature maps are stored in memory as
continuous arrays. Order of elements depends on the order of
dimensions – data layout. <a class="reference internal" href="#multidim-data-layout"><span class="std std-numref">Table 5</span></a> describes
two supported and traditionally used data layouts – HWC and CHW.</div></blockquote>
<p></p>
<span id="multidim-data-layout"></span><table border="1" class="colwidths-auto docutils" id="id6">
<caption><span class="caption-number">Table 5 </span><span class="caption-text">Multidimensional Data Layout</span><a class="headerlink" href="#id6" title="Permalink to this table">¶</a></caption>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Designation</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>HWC</td>
<td>The smallest stride between
dimension elements in memory is
for C (channel or depth) followed
by the width and the height. The
height is the least frequently
changing index. For example
<em>In[32][16][8]</em> for this case is
a feature map with 32 rows
(<strong>h</strong>eight), 16 columns
(<strong>w</strong>idth) and 8
<strong>c</strong>hannels.</td>
</tr>
<tr class="row-odd"><td>CHW</td>
<td>The smallest stride between
dimension elements in memory is
for W (width). Then height. The
channel is least frequently
changing index. For example
<em>In[32][16][8]</em> for this case is
a feature map with 32
<strong>c</strong>hannels, 16 rows
(<strong>h</strong>eight) and 8 columns
(<strong>w</strong>idth).</td>
</tr>
</tbody>
</table>
<blockquote>
<div><p>Due to algorithmic reasons, HWC layout provides higher data locality
for some functions, and CHW layout does so for others.</p>
<p>“Data locality” means the data disposition in memory where elements
consistently used by algorithm are stored in memory as close as
possible (in ideal case, contiguously). Low data locality could
reduce performance of systems with cache. For the layouts supported
by particular kernels, see <a class="reference internal" href="#fns"><span class="std std-ref">Functions</span></a>. Current version of MLI Library
focuses on optimization of kernels for CHW layout.</p>
</div></blockquote>
</div>
<div class="section" id="functions">
<span id="fns"></span><h2>Functions<a class="headerlink" href="#functions" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p>In general, several functions are implemented for each primitive
supported by MLI library. Each function (implementation of primitive)
is designed to deal with specific inputs. Therefore, you must meet the
assumptions that functions make. For example, function designed to
perform 2D convolution for data of <code class="docutils literal notranslate"><span class="pre">fx8</span></code> type must not be used with
data of <code class="docutils literal notranslate"><span class="pre">fx16</span></code> type.</p>
<p>All assumptions are reflected in function name according to naming
convention (see <a class="reference internal" href="#mli-func-naming-conv"><span class="std std-numref">Table 6</span></a> and
<a class="reference internal" href="#mli-fn-spl"><span class="std std-numref">Table 7</span></a>). MLI Library functions have at
least one assumption on input data types. Functions with only
data-type assumption are referred to as generic functions while
functions with additional assumptions referred to as specialized
functions or specializations.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">A lot of specializations along with generic functions are implemented in convolution and pooling groups for each primitive. Generic functions are typically slower than the specialized ones. For this reason, a function without postfix performs switching logic to choose the correct specialized function or a generic function if there is no appropriate specialization. Such ‘switchers’ significantly increase the code size of application and should be used only in development or intentionally. Generic functions have a ‘_generic’ name postfix, and specializations have a descriptive postfix.</p>
</div>
</div></blockquote>
<div class="section" id="naming-convention">
<h3>Naming Convention<a class="headerlink" href="#naming-convention" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div>MLI Library function adheres naming convention listed in <a class="reference internal" href="#mli-func-naming-conv"><span class="std std-numref">Table 6</span></a>:</div></blockquote>
<p></p>
<span id="mli-func-naming-conv"></span><table border="1" class="colwidths-auto docutils" id="id7">
<caption><span class="caption-number">Table 6 </span><span class="caption-text">MLI Library Functions Naming Convention</span><a class="headerlink" href="#id7" title="Permalink to this table">¶</a></caption>
<thead valign="bottom">
<tr class="row-odd"><th class="head" colspan="3"><code class="docutils literal notranslate"><span class="pre">mli_&lt;set&gt;_&lt;type&gt;_[layout]_&lt;data_type&gt;_[spec](&lt;in_data&gt;,[config],&lt;out_data&gt;);</span></code></th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Field name</td>
<td>Field Entries</td>
<td>Field Description</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">set</span></code></td>
<td><p class="first"><code class="docutils literal notranslate"><span class="pre">krn</span></code></p>
<p class="last"><code class="docutils literal notranslate"><span class="pre">hlp</span></code></p>
</td>
<td>Mandatory. Specifies
set of functions
related to the
implementation. See
<a class="reference internal" href="#gen-api-struct"><span class="std std-ref">General API Structure</span></a>
for more information.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">type</span></code></td>
<td><p class="first"><code class="docutils literal notranslate"><span class="pre">conv2d</span></code></p>
<p class="last"><code class="docutils literal notranslate"><span class="pre">fully_connected</span></code></p>
</td>
<td>Mandatory. Specifies
particular type of
primitive supported
by the library</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">layout</span></code></td>
<td><p class="first"><code class="docutils literal notranslate"><span class="pre">chw</span></code></p>
<p class="last"><code class="docutils literal notranslate"><span class="pre">hwc</span></code></p>
</td>
<td>Optional. Specifies
data layout for
image-like inputs.
See <a class="reference internal" href="#data-types"><span class="std std-ref">Data Types</span></a> for
more information.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">data_type</span></code></td>
<td><p class="first"><code class="docutils literal notranslate"><span class="pre">fx8</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">fx16</span></code></p>
<p class="last"><code class="docutils literal notranslate"><span class="pre">fx8w16d</span></code></p>
</td>
<td><p class="first">Mandatory. Specifies
the tensor basic
element type expected
by the function.</p>
<p>fx8w16d means weights
and bias tensors are
8-bit, while all the
others are 16-bit.</p>
<p class="last">For more information,
see <a class="reference internal" href="arithmetic_details.html#mli-fpd-fmt"><span class="std std-ref">MLI Fixed-Point Data Format</span></a></p>
</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">spec</span></code></td>
<td>&#160;</td>
<td>Optional. Reflects
additional
assumptions of
function. For
example, if the
function can only
process convolutions
of a 3x3 kernel, this
should be reflected
in this field (see
<a class="reference internal" href="#mli-fn-spl"><span class="std std-numref">Table 7</span></a>)</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">in_data</span></code></td>
<td>&#160;</td>
<td>Mandatory. Input data
tensors</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">config</span></code></td>
<td>&#160;</td>
<td>Optional. Structure
of primitive-specific
parameters</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">out_data</span></code></td>
<td>&#160;</td>
<td>Mandatory. Output
data tensors</td>
</tr>
</tbody>
</table>
<blockquote>
<div><p>Example:</p>
<p><code class="docutils literal notranslate"><span class="pre">mli_krn_avepool_hwc_fx8(const</span> <span class="pre">mli_tensor</span> <span class="pre">*in,</span> <span class="pre">const</span> <span class="pre">mli_pool_cfg</span> <span class="pre">*cfg,</span> <span class="pre">mli_tensor</span> <span class="pre">*out);</span></code></p>
</div></blockquote>
</div>
<div class="section" id="specialized-functions">
<span id="spec-fns"></span><h3>Specialized Functions<a class="headerlink" href="#specialized-functions" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div>Naming convention for the specializations: </div></blockquote>
<span id="mli-fn-spl"></span><table border="1" class="colwidths-auto docutils" id="id8">
<caption><span class="caption-number">Table 7 </span><span class="caption-text">MLI Library Functions Naming - Specialization Details</span><a class="headerlink" href="#id8" title="Permalink to this table">¶</a></caption>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Configuration
parameter</th>
<th class="head">Naming convention</th>
<th class="head">Relevant for</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">Kernel</span> <span class="pre">size</span></code></td>
<td><p class="first">[_k<em>n</em>x<em>m</em>]</p>
<p class="last">where <em>n</em> and <em>m</em> are
the kernel dimensions
example: _k1x1, _k3x3.
One of dimension might
be left unfixed example
_k1xn</p>
</td>
<td>convolution group,
pooling group</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">Padding</span></code></td>
<td><p class="first">[_nopad | _krnpad]</p>
<p class="last">Where _nopad
functions assumes
that all padding
parameters are
zeros, and _krnpad
functions assumes
smallest padding
parameters to achieve
same output size
(similar to ‘SAME’
padding scheme used
in TensorFlow [3])</p>
</td>
<td>convolution group,
pooling group</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">Input</span> <span class="pre">channels</span></code></td>
<td><p class="first">[_ch<em>n</em>]</p>
<p class="last">where <em>n</em> is the
number of channels
example _ch1, _ch4</p>
</td>
<td>convolution group,
pooling group</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">Stride</span></code></td>
<td><p class="first">[_str[h|w]<em>n</em>]</p>
<p class="last">where n is the stride
value, if needed h or
w can be used if
horizontal stride is
different from
vertical if omitted,
both strides are
equal. Example: _str1,
_strh2_strw1</p>
</td>
<td>convolution group,
pooling group</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">Generalization</span></code></td>
<td><p class="first">[_generic]</p>
<p class="last">If there are a lot of
specializations for a
primitive, _generic
functions can process
inputs with any
combinations of
parameters.
Unspecialized
functions (without
[_spec] field in
name) behave as
“switches” which
analyze inputs and
choose suitable
specialization.
Switch   chooses
_generic version in
case there are no
suitable
specializations.</p>
</td>
<td>convolution group,
pooling group</td>
</tr>
</tbody>
</table>
<p></p>
<blockquote>
<div>For example, the function name of a 16bit 2d convolution kernel with
CHW layout and a kernel size of 3x3 and stride of 1 is:
<code class="docutils literal notranslate"><span class="pre">mli_krn_conv2d_chw_fx16_k3x3_str1()</span></code>.</div></blockquote>
</div>
</div>
<div class="section" id="error-codes">
<span id="err-codes"></span><h2>Error Codes<a class="headerlink" href="#error-codes" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p>Functions return value of <em>mli_status</em> enumeration type which is
declared in <strong>include/MLI_types.h</strong>. By default, functions do not
validate inputs and typically return only <code class="docutils literal notranslate"><span class="pre">MLI_STATUS_OK</span></code>.</p>
<p>To turn on the checking logic, ensure that you build the MLI library
with along with the required debug mode as described in section
<a class="reference internal" href="#func-param-dbg"><span class="std std-ref">Function Parameters Examination and Debug (MLI_DEBUG_MODE)</span></a>. This might slightly affect the performance and code size of the library.</p>
<p><a class="reference internal" href="#mli-status-val-desc"><span class="std std-numref">Table 8</span></a> contains list of status code with description.</p>
</div></blockquote>
<span id="mli-status-val-desc"></span><table border="1" class="colwidths-auto docutils" id="id9">
<caption><span class="caption-number">Table 8 </span><span class="caption-text">mli_status Values Description</span><a class="headerlink" href="#id9" title="Permalink to this table">¶</a></caption>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Value</th>
<th class="head">Field Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">MLI_STATUS_OK</span></code></td>
<td>No error occurred</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">MLI_STATUS_BAD_TENSOR</span></code></td>
<td>Invalid tensor is passed to the
function</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">MLI_STATUS_SHAPE_MISMATCH</span></code></td>
<td>Shape of tensors are not
compatible for the function</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">MLI_STATUS_BAD_FUNC_CFG</span></code></td>
<td>Invalid configuration structure
is passed</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">MLI_STATUS_NOT_ENGH_MEM</span></code></td>
<td>Capacity of output tensor is not
enough for function result</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">MLI_STATUS_NOT_SUPPORTED</span></code></td>
<td>Function is not yet implemented,
or inputs combination is not
supported.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">MLI_STATUS_SPEC_PARAM_MISMATCH</span></code></td>
<td>Function parameters do not match
the one specified in the
specialized function.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="global-definitions-and-library-configurability">
<h2>Global Definitions and Library Configurability<a class="headerlink" href="#global-definitions-and-library-configurability" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div>All configurable global definitions and constants are defined in <code class="docutils literal notranslate"><span class="pre">./include/MLI_config.h</span></code>. This header file is not included in <code class="docutils literal notranslate"><span class="pre">./include/MLI_API.h</span></code> header and should be included implicitly in user code in case its content might be useful. For example, use <code class="docutils literal notranslate"><span class="pre">ARC_PLATFORM</span></code> define for multi-platform applications.</div></blockquote>
<div class="section" id="target-platform-definition-arc-platform">
<span id="tgt-pf-def"></span><h3>Target Platform Definition (ARC_PLATFORM)<a class="headerlink" href="#target-platform-definition-arc-platform" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>ARC_PLATFORM defines main platform type that the library is built
for. By default this is determined in compile time according to the
TCF file. To explicitly set platform, set ARC_PLATFORM to one of the
following macros in advance:</p>
<ul class="simple">
<li><strong>V2DSP</strong> – using ARCv2DSP ISA extensions only (EM5D or EM7D).</li>
<li><strong>V2DSP_WIDE</strong> – using wide ARCv2DSP ISA extensions (HS45D or HS47D)</li>
<li><strong>V2DSP_XY</strong> – using ARCv2DSP ISA extensions and AGU (EM9D or EM11D).</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="function-parameters-examination-and-debug-mli-debug-mode">
<span id="func-param-dbg"></span><h3>Function Parameters Examination and Debug (MLI_DEBUG_MODE)<a class="headerlink" href="#function-parameters-examination-and-debug-mli-debug-mode" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>MLI Library supports three debug modes. You can choose the debug mode
by setting MLI_DEBUG_MODE define as follows:</p>
<ul class="simple">
<li><strong>DBG_MODE_RELEASE</strong> (<strong>MLI_DEBUG_MODE</strong> = 0) – No debug. Functions
do not examine parameters, and process data assuming they are valid.
This might lead to undefined behavior if the assumption is not true.
Functions always return MLI_STATUS_OK. No messages are printed, and
no assertions are used.</li>
<li><strong>DBG_MODE_RET_CODES</strong> (<strong>MLI_DEBUG_MODE</strong> = 1) – Functions examine
parameters and return valid error status if any violation of data is
found. Else, functions process data and return status MLI_STATUS_OK.
No messages are printed and no assertions are used.</li>
<li><strong>DBG_MODE_FULL</strong> (<strong>MLI_DEBUG_MODE</strong> = 3) – Functions examine
parameters. If any violation of data is found, the function prints a
descriptive message using standard <strong>printf()</strong> function and tries to
break the execution using <strong>assert()</strong> function. If the <strong>assert()</strong>
function does not break the execution, function returns error status.</li>
</ul>
</div></blockquote>
<blockquote>
<div>By default, <code class="docutils literal notranslate"><span class="pre">MLI_DEBUG_MODE</span></code> is set to <code class="docutils literal notranslate"><span class="pre">DBG_MODE_RELEASE</span></code>.</div></blockquote>
</div>
<div class="section" id="concatenation-primitive-maximum-tensors-to-concatenate-mli-concat-max-tensors">
<h3>Concatenation Primitive: Maximum Tensors to Concatenate (MLI_CONCAT_MAX_TENSORS)<a class="headerlink" href="#concatenation-primitive-maximum-tensors-to-concatenate-mli-concat-max-tensors" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div>This primitive configures maximum number of tensors for concatenation
by appropriate primitive (see <a class="reference internal" href="../kernel_func_desc/data_manipulation_group.html#concat"><span class="std std-ref">Concatenation</span></a> ). Default: 8.</div></blockquote>
</div>
</div>
<div class="section" id="memory-allocation">
<h2>Memory Allocation<a class="headerlink" href="#memory-allocation" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div>Library does not allocate any memory dynamically. Application is
responsible for providing correct parameters for function and
allocate memory for it if necessary. Library might use internal
statically allocated data (tables of constants).</div></blockquote>
</div>
<div class="section" id="hardware-components-dependencies">
<span id="hw-comp-dpd"></span><h2>Hardware Components Dependencies<a class="headerlink" href="#hardware-components-dependencies" title="Permalink to this headline">¶</a></h2>
<div class="section" id="dsp-control">
<h3>DSP Control<a class="headerlink" href="#dsp-control" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>MLI Library intensively uses ARCv2DSP extension of ARC EM and ARC HS
processors. Ensure that this extension is present and correctly
configured in hardware.</p>
<p>Ensure that you build the library with the appropriate command line
parameter:</p>
<p><code class="docutils literal notranslate"><span class="pre">-Xdsp_ctrl=postshift,guard,convergent</span></code></p>
</div></blockquote>
<blockquote>
<div>Where “up” defines the rounding mode of DSP hardware (rounding up)
and it is the only parameter which might be changed (to “convergent” -
round to the nearest even). All parameters are described in <em>MetaWare
Fixed-Point Reference for ARC EM and ARC HS</em>.</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">MLI Library sets the required DSP   mode inside each function where it is needed, but does not restore it to previous state. If another ARC DSP code beside MLI library is used in an application, ensure that you set the required DSP mode before its execution. For more information see  “Configuring the ARC DSP Extensions” section of entry [4] of <a class="reference internal" href="../final/references.html#refs"><span class="std std-ref">References</span></a> or “Using the FXAPI” section of entry [5] of <a class="reference internal" href="../final/references.html#refs"><span class="std std-ref">References</span></a>.</p>
</div>
</div>
<div class="section" id="agu-support">
<h3>AGU Support<a class="headerlink" href="#agu-support" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>Library is optimized for systems with and without AGU (address
generation unit). If AGU is present in the system, then library code
optimized for AGU is compiled automatically, otherwise the AGU
optimization is not used (see <a class="reference internal" href="#tgt-pf-def"><span class="std std-ref">Target Platform Definition (ARC_PLATFORM)</span></a>).
Inside primitives, pointers to some data defined with use of
MLI_PTR(p) macro expand into “__xy p *” in AGU systems, and to “p
*” in system without AGU. An application is responsible for
allocation of relevant buffers in the AGU memory region (for more
information see “XY Memory Optimization” chapter <em>of MetaWare DSP
Programming Guide for ARC EM and ARC HS</em>).</p>
<p><a class="reference internal" href="#agu-req-tensors"><span class="std std-numref">Table 9</span></a> provides information about tensors must
be allocated into AGUaccessible memory for each primitive. Tensors
not mentioned in <a class="reference internal" href="#agu-req-tensors"><span class="std std-numref">Table 9</span></a> does not have to be allocated in the
same way.</p>
</div></blockquote>
<span id="agu-req-tensors"></span><table border="1" class="colwidths-auto docutils" id="id10">
<caption><span class="caption-number">Table 9 </span><span class="caption-text">AGU Requirements for Tensors</span><a class="headerlink" href="#id10" title="Permalink to this table">¶</a></caption>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Primitive</th>
<th class="head">Tensors must be allocated into
AGU accessible memory</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Convolution 2D</td>
<td>in, weights, out, biases</td>
</tr>
<tr class="row-odd"><td>Depthwise convolution</td>
<td>in, weights, out, biases</td>
</tr>
<tr class="row-even"><td>Max Pooling</td>
<td>In, out</td>
</tr>
<tr class="row-odd"><td>Average Pooling</td>
<td>In, out</td>
</tr>
<tr class="row-even"><td>Fully connected</td>
<td>In, out</td>
</tr>
<tr class="row-odd"><td>Long Short Term Memory</td>
<td>In, weights, biases, out,
prev_out, ir_tsr</td>
</tr>
<tr class="row-even"><td>Basic RNN cell</td>
<td>In, weights, biases, out,
prev_out, ir_tsr</td>
</tr>
<tr class="row-odd"><td>ReLU</td>
<td>In, out</td>
</tr>
<tr class="row-even"><td>Leaky ReLU</td>
<td>In, out</td>
</tr>
<tr class="row-odd"><td>Sigmoid</td>
<td>In, out</td>
</tr>
<tr class="row-even"><td>TanH</td>
<td>In, out</td>
</tr>
<tr class="row-odd"><td>Softmax</td>
<td>In, out</td>
</tr>
<tr class="row-even"><td>Eltwise
add/subtract/max/multiplication</td>
<td>In1, in2, out</td>
</tr>
<tr class="row-odd"><td>Concatenation</td>
<td><ul class="first last simple">
<li></li>
</ul>
</td>
</tr>
<tr class="row-even"><td>Permute</td>
<td><ul class="first last simple">
<li></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td>Padding 2D</td>
<td><ul class="first last simple">
<li></li>
</ul>
</td>
</tr>
</tbody>
</table>
<p></p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="arithmetic_details.html" class="btn btn-neutral float-right" title="Arithmetic Details" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="index.html" class="btn btn-neutral float-left" title="Machine Learning Inference Library API" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Synopsys, Inc

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>